---
# tasks file for digitransit-azure-deploy

- name: deploy digitransit-ui-hsl to DC/OS
  uri:
    url: "{{dcos_uri}}"
    method: POST
    body: "{{ lookup('file','digitransit-ui-hsl.json') }}"
    body_format: json
    HEADER_Content-Type: "application/json"
    status_code: 200,201

- name: deploy opentripplanner-hsl to DC/OS
  uri:
    url: "{{dcos_uri}}"
    method: POST
    body: "{{ lookup('file','opentripplanner-hsl.json') }}"
    body_format: json
    HEADER_Content-Type: "application/json"
    status_code: 200,201

- name: deploy hsl-map-server to DC/OS
  uri:
    url: "{{dcos_uri}}"
    method: POST
    body: "{{ lookup('file','hsl-map-server.json') }}"
    body_format: json
    HEADER_Content-Type: "application/json"
    status_code: 200,201

- name: deploy pelias-data-container to DC/OS
  uri:
    url: "{{dcos_uri}}"
    method: POST
    body: "{{ lookup('file','pelias-data-container.json') }}"
    body_format: json
    HEADER_Content-Type: "application/json"
    status_code: 200,201

- name: deploy pelias-api to DC/OS
  uri:
    url: "{{dcos_uri}}"
    method: POST
    body: "{{ lookup('file','pelias-api.json') }}"
    body_format: json
    HEADER_Content-Type: "application/json"
    status_code: 200,201

#digitransit proxy has to be the last component to be deployed
#LB DNS entries in DC/OS need to exist before NGINX container will start

- name: deploy digitransit proxy to DC/OS
  uri:
    url: "{{dcos_uri}}"
    method: POST
    body: "{{ lookup('file','digitransit-proxy.json') }}"
    body_format: json
    HEADER_Content-Type: "application/json"
    status_code: 200,201


